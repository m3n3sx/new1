<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAS UI Repair - Final System Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f1f1f1;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .test-header {
            background: #0073aa;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-section {
            padding: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .test-section:last-child {
            border-bottom: none;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            background: #f9f9f9;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-warn {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pass { background: #28a745; }
        .status-fail { background: #dc3545; }
        .status-warn { background: #ffc107; }
        .status-pending { background: #6c757d; }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .action-buttons {
            margin: 20px 0;
            text-align: center;
        }
        
        .btn {
            background: #0073aa;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #005a87;
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        /* Mock WordPress Admin Styles */
        .wp-admin {
            background: #f1f1f1;
        }
        
        .las-fresh-settings-wrap {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.13);
        }
        
        .nav-tab-wrapper {
            border-bottom: 1px solid #ccc;
            margin: 0 0 20px;
            padding-top: 0;
        }
        
        .nav-tab {
            background: #e4e4e4;
            border: 1px solid #ccc;
            border-bottom: none;
            color: #555;
            display: inline-block;
            font-size: 12px;
            font-weight: bold;
            line-height: 16px;
            margin: 0 5px -1px 0;
            padding: 8px 12px;
            text-decoration: none;
            cursor: pointer;
        }
        
        .nav-tab.active,
        .nav-tab.nav-tab-active {
            background: #fff;
            border-bottom: 1px solid #fff;
            color: #000;
        }
        
        .las-tab-panel {
            display: none;
            padding: 20px;
        }
        
        .las-tab-panel.active {
            display: block;
        }
        
        .form-table {
            width: 100%;
        }
        
        .form-table th {
            text-align: left;
            padding: 20px 10px 20px 0;
            width: 200px;
            vertical-align: top;
        }
        
        .form-table td {
            padding: 15px 10px;
            vertical-align: top;
        }
        
        .notice {
            background: #fff;
            border-left: 4px solid #fff;
            box-shadow: 0 1px 1px 0 rgba(0,0,0,.1);
            margin: 5px 15px 2px;
            padding: 1px 12px;
        }
        
        .notice-error {
            border-left-color: #dc3232;
        }
        
        .notice-success {
            border-left-color: #46b450;
        }
        
        .notice-warning {
            border-left-color: #ffb900;
        }
        
        .notice-info {
            border-left-color: #00a0d2;
        }
    </style>
</head>
<body class="wp-admin">
    <div class="test-container">
        <div class="test-header">
            <h1>Live Admin Styler - Final System Integration Test</h1>
            <p>Comprehensive validation of UI repair system integration</p>
        </div>

        <div class="test-section">
            <h3>Test Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="progressText">Initializing tests...</div>
        </div>

        <div class="test-section">
            <h3>System Status</h3>
            <div class="test-grid">
                <div class="test-card">
                    <h4>Environment Validation</h4>
                    <div id="environmentStatus">
                        <span class="status-indicator status-pending"></span>
                        Checking environment...
                    </div>
                </div>
                <div class="test-card">
                    <h4>Dependency Loading</h4>
                    <div id="dependencyStatus">
                        <span class="status-indicator status-pending"></span>
                        Loading dependencies...
                    </div>
                </div>
                <div class="test-card">
                    <h4>Integration Manager</h4>
                    <div id="integrationStatus">
                        <span class="status-indicator status-pending"></span>
                        Initializing integration...
                    </div>
                </div>
                <div class="test-card">
                    <h4>Component System</h4>
                    <div id="componentStatus">
                        <span class="status-indicator status-pending"></span>
                        Loading components...
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>Component Tests</h3>
            <div id="componentTests"></div>
        </div>

        <div class="test-section">
            <h3>UI Functionality Tests</h3>
            <div class="las-fresh-settings-wrap">
                <div class="nav-tab-wrapper">
                    <a href="#" class="nav-tab active" data-tab="general">General</a>
                    <a href="#" class="nav-tab" data-tab="layout">Layout</a>
                    <a href="#" class="nav-tab" data-tab="menu">Menu</a>
                    <a href="#" class="nav-tab" data-tab="advanced">Advanced</a>
                </div>

                <div class="las-tab-panel active" id="las-tab-general">
                    <h3>General Settings</h3>
                    <table class="form-table">
                        <tr>
                            <th>Test Input</th>
                            <td><input type="text" id="testInput" value="Test value" /></td>
                        </tr>
                        <tr>
                            <th>Test Color</th>
                            <td><input type="color" id="testColor" value="#0073aa" /></td>
                        </tr>
                        <tr>
                            <th>Test Range</th>
                            <td><input type="range" id="testRange" min="0" max="100" value="50" /></td>
                        </tr>
                        <tr>
                            <th>Test Checkbox</th>
                            <td><input type="checkbox" id="testCheckbox" checked /></td>
                        </tr>
                    </table>
                </div>

                <div class="las-tab-panel" id="las-tab-layout">
                    <h3>Layout Settings</h3>
                    <p>Layout configuration options would go here.</p>
                </div>

                <div class="las-tab-panel" id="las-tab-menu">
                    <h3>Menu Settings</h3>
                    <p>Menu configuration options would go here.</p>
                </div>

                <div class="las-tab-panel" id="las-tab-advanced">
                    <h3>Advanced Settings</h3>
                    <p>Advanced configuration options would go here.</p>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>Error Handling Tests</h3>
            <div id="errorTests"></div>
        </div>

        <div class="test-section">
            <h3>Performance Metrics</h3>
            <div id="performanceMetrics"></div>
        </div>

        <div class="test-section">
            <h3>Test Results Summary</h3>
            <div id="testSummary"></div>
        </div>

        <div class="action-buttons">
            <button class="btn" onclick="runAllTests()">Run All Tests</button>
            <button class="btn btn-secondary" onclick="runComponentTests()">Test Components</button>
            <button class="btn btn-secondary" onclick="runUITests()">Test UI</button>
            <button class="btn btn-secondary" onclick="runErrorTests()">Test Errors</button>
            <button class="btn btn-success" onclick="exportResults()">Export Results</button>
            <button class="btn btn-danger" onclick="resetTests()">Reset Tests</button>
        </div>
    </div>

    <!-- Mock WordPress admin data -->
    <script>
        window.lasAdminData = {
            ajaxUrl: '/wp-admin/admin-ajax.php',
            nonce: 'test-nonce-12345',
            debug: true,
            version: '1.0.0',
            pluginUrl: '/wp-content/plugins/live-admin-styler/',
            uiRepair: {
                timeout: 10000,
                retryAttempts: 3,
                debounceDelay: 300,
                enableGracefulDegradation: true
            },
            strings: {
                errorTitle: 'Live Admin Styler UI Error',
                errorMessage: 'Failed to initialize interface. Please refresh the page.',
                loadingAssets: 'Loading interface assets...',
                assetLoadFailed: 'Failed to load required assets.'
            }
        };
    </script>

    <!-- Load UI Repair Integration System -->
    <script src="../assets/js/ui-repair-integration.js"></script>

    <!-- Test Suite -->
    <script>
        class LASIntegrationTestSuite {
            constructor() {
                this.tests = [];
                this.results = [];
                this.startTime = null;
                this.totalTests = 0;
                this.passedTests = 0;
                this.failedTests = 0;
                this.warnings = 0;
            }

            async runAllTests() {
                this.startTime = performance.now();
                this.updateProgress(0, 'Starting comprehensive test suite...');

                try {
                    // Environment tests
                    await this.runEnvironmentTests();
                    this.updateProgress(20, 'Environment tests complete');

                    // Dependency tests
                    await this.runDependencyTests();
                    this.updateProgress(40, 'Dependency tests complete');

                    // Integration tests
                    await this.runIntegrationTests();
                    this.updateProgress(60, 'Integration tests complete');

                    // Component tests
                    await this.runComponentTests();
                    this.updateProgress(80, 'Component tests complete');

                    // UI functionality tests
                    await this.runUIFunctionalityTests();
                    this.updateProgress(90, 'UI functionality tests complete');

                    // Error handling tests
                    await this.runErrorHandlingTests();
                    this.updateProgress(95, 'Error handling tests complete');

                    // Performance tests
                    await this.runPerformanceTests();
                    this.updateProgress(100, 'All tests complete');

                    this.generateSummary();

                } catch (error) {
                    this.logError('Test suite failed', error);
                    this.updateProgress(100, 'Test suite failed with errors');
                }
            }

            async runEnvironmentTests() {
                this.logTest('Environment Validation', 'Testing environment setup...');

                // Test 1: Check for required globals
                const hasWindow = typeof window !== 'undefined';
                const hasDocument = typeof document !== 'undefined';
                this.recordTest('Global Objects', hasWindow && hasDocument, 
                    hasWindow && hasDocument ? 'Window and document available' : 'Missing global objects');

                // Test 2: Check WordPress admin context
                const isWPAdmin = document.body.classList.contains('wp-admin');
                this.recordTest('WordPress Admin Context', isWPAdmin, 
                    isWPAdmin ? 'In WordPress admin context' : 'Not in WordPress admin context', 'warn');

                // Test 3: Check for plugin container
                const hasContainer = document.querySelector('.las-fresh-settings-wrap') !== null;
                this.recordTest('Plugin Container', hasContainer, 
                    hasContainer ? 'Plugin container found' : 'Plugin container not found');

                // Test 4: Check admin data
                const hasAdminData = typeof window.lasAdminData !== 'undefined';
                this.recordTest('Admin Data', hasAdminData, 
                    hasAdminData ? 'Admin data available' : 'Admin data missing');

                this.updateStatus('environmentStatus', this.getOverallStatus(['Global Objects', 'Plugin Container', 'Admin Data']));
            }

            async runDependencyTests() {
                this.logTest('Dependency Loading', 'Testing dependency availability...');

                // Test jQuery availability
                const hasJQuery = typeof window.$ !== 'undefined' || typeof window.jQuery !== 'undefined';
                this.recordTest('jQuery', hasJQuery, 
                    hasJQuery ? 'jQuery available' : 'jQuery not available', hasJQuery ? 'pass' : 'warn');

                // Test integration manager
                const hasIntegrationManager = typeof window.LASIntegrationManager !== 'undefined';
                this.recordTest('Integration Manager Class', hasIntegrationManager, 
                    hasIntegrationManager ? 'Integration manager class available' : 'Integration manager class missing');

                // Test integration manager instance
                const hasIntegrationInstance = typeof window.lasIntegrationManager !== 'undefined';
                this.recordTest('Integration Manager Instance', hasIntegrationInstance, 
                    hasIntegrationInstance ? 'Integration manager instance available' : 'Integration manager instance missing');

                this.updateStatus('dependencyStatus', this.getOverallStatus(['jQuery', 'Integration Manager Class', 'Integration Manager Instance']));
            }

            async runIntegrationTests() {
                this.logTest('Integration Manager', 'Testing integration manager functionality...');

                if (typeof window.lasIntegrationManager === 'undefined') {
                    this.recordTest('Integration Manager', false, 'Integration manager not available');
                    this.updateStatus('integrationStatus', 'fail');
                    return;
                }

                const manager = window.lasIntegrationManager;

                // Test initialization
                const isInitialized = manager.initialized;
                this.recordTest('Manager Initialization', isInitialized, 
                    isInitialized ? 'Integration manager initialized' : 'Integration manager not initialized');

                // Test core manager
                const hasCoreManager = manager.coreManager !== null;
                this.recordTest('Core Manager', hasCoreManager, 
                    hasCoreManager ? 'Core manager available' : 'Core manager missing');

                // Test status method
                let statusAvailable = false;
                try {
                    const status = manager.getStatus();
                    statusAvailable = typeof status === 'object';
                    this.recordTest('Status Method', statusAvailable, 
                        statusAvailable ? 'Status method working' : 'Status method failed');
                } catch (error) {
                    this.recordTest('Status Method', false, `Status method error: ${error.message}`);
                }

                this.updateStatus('integrationStatus', this.getOverallStatus(['Manager Initialization', 'Core Manager', 'Status Method']));
            }

            async runComponentTests() {
                this.logTest('Component System', 'Testing component availability and functionality...');

                const requiredComponents = [
                    'LASStateManager',
                    'LASEventManager', 
                    'LASTabManager',
                    'LASMenuManager',
                    'LASFormManager',
                    'LASErrorReporter',
                    'LASGracefulDegradation'
                ];

                const componentTestsHtml = document.getElementById('componentTests');
                componentTestsHtml.innerHTML = '';

                for (const componentName of requiredComponents) {
                    const componentExists = typeof window[componentName] !== 'undefined';
                    
                    let instanceWorks = false;
                    let initWorks = false;
                    
                    if (componentExists) {
                        try {
                            const instance = new window[componentName]({});
                            instanceWorks = true;
                            
                            if (typeof instance.init === 'function') {
                                await instance.init();
                                initWorks = true;
                            }
                        } catch (error) {
                            this.logError(`${componentName} instantiation failed`, error);
                        }
                    }

                    this.recordTest(`${componentName} Class`, componentExists, 
                        componentExists ? 'Component class available' : 'Component class missing');
                    
                    if (componentExists) {
                        this.recordTest(`${componentName} Instance`, instanceWorks, 
                            instanceWorks ? 'Component instantiation works' : 'Component instantiation failed');
                        
                        this.recordTest(`${componentName} Init`, initWorks, 
                            initWorks ? 'Component initialization works' : 'Component initialization failed');
                    }

                    // Add component test card
                    const testCard = document.createElement('div');
                    testCard.className = 'test-card';
                    testCard.innerHTML = `
                        <h4>${componentName}</h4>
                        <div>Class: <span class="status-indicator ${componentExists ? 'status-pass' : 'status-fail'}"></span></div>
                        <div>Instance: <span class="status-indicator ${instanceWorks ? 'status-pass' : 'status-fail'}"></span></div>
                        <div>Init: <span class="status-indicator ${initWorks ? 'status-pass' : 'status-fail'}"></span></div>
                    `;
                    componentTestsHtml.appendChild(testCard);
                }

                this.updateStatus('componentStatus', this.getOverallStatus(requiredComponents.map(name => `${name} Class`)));
            }

            async runUIFunctionalityTests() {
                this.logTest('UI Functionality', 'Testing UI component functionality...');

                // Test tab functionality
                await this.testTabFunctionality();

                // Test form controls
                await this.testFormControls();

                // Test state management
                await this.testStateManagement();
            }

            async testTabFunctionality() {
                const tabs = document.querySelectorAll('.nav-tab');
                const panels = document.querySelectorAll('.las-tab-panel');

                // Test tab discovery
                const tabsFound = tabs.length > 0;
                const panelsFound = panels.length > 0;
                this.recordTest('Tab Discovery', tabsFound && panelsFound, 
                    `Found ${tabs.length} tabs and ${panels.length} panels`);

                // Test tab clicking
                if (tabs.length > 1) {
                    const secondTab = tabs[1];
                    const tabId = secondTab.dataset.tab;
                    
                    // Simulate click
                    secondTab.click();
                    
                    // Check if tab became active
                    const tabActive = secondTab.classList.contains('active') || secondTab.classList.contains('nav-tab-active');
                    this.recordTest('Tab Switching', tabActive, 
                        tabActive ? 'Tab switching works' : 'Tab switching failed');

                    // Check if corresponding panel is visible
                    const panel = document.getElementById(`las-tab-${tabId}`);
                    const panelVisible = panel && (panel.classList.contains('active') || panel.style.display !== 'none');
                    this.recordTest('Panel Visibility', panelVisible, 
                        panelVisible ? 'Panel visibility works' : 'Panel visibility failed');
                }
            }

            async testFormControls() {
                const controls = [
                    { id: 'testInput', type: 'text' },
                    { id: 'testColor', type: 'color' },
                    { id: 'testRange', type: 'range' },
                    { id: 'testCheckbox', type: 'checkbox' }
                ];

                for (const control of controls) {
                    const element = document.getElementById(control.id);
                    const exists = element !== null;
                    
                    this.recordTest(`${control.type} Control`, exists, 
                        exists ? `${control.type} control found and accessible` : `${control.type} control missing`);

                    if (exists) {
                        // Test value setting
                        try {
                            const originalValue = element.value;
                            const testValue = control.type === 'checkbox' ? !element.checked : 'test-value';
                            
                            if (control.type === 'checkbox') {
                                element.checked = testValue;
                            } else {
                                element.value = testValue;
                            }
                            
                            // Trigger change event
                            element.dispatchEvent(new Event('change', { bubbles: true }));
                            
                            this.recordTest(`${control.type} Control Interaction`, true, 
                                `${control.type} control interaction works`);
                        } catch (error) {
                            this.recordTest(`${control.type} Control Interaction`, false, 
                                `${control.type} control interaction failed: ${error.message}`);
                        }
                    }
                }
            }

            async testStateManagement() {
                if (typeof window.lasIntegrationManager === 'undefined' || 
                    !window.lasIntegrationManager.coreManager) {
                    this.recordTest('State Management', false, 'Integration manager not available');
                    return;
                }

                const stateManager = window.lasIntegrationManager.coreManager.components.get('state');
                
                if (!stateManager) {
                    this.recordTest('State Manager', false, 'State manager not available');
                    return;
                }

                try {
                    // Test state setting and getting
                    const testKey = 'test-key';
                    const testValue = 'test-value';
                    
                    stateManager.set(testKey, testValue);
                    const retrievedValue = stateManager.get(testKey);
                    
                    const stateWorks = retrievedValue === testValue;
                    this.recordTest('State Management', stateWorks, 
                        stateWorks ? 'State management works' : 'State management failed');
                } catch (error) {
                    this.recordTest('State Management', false, `State management error: ${error.message}`);
                }
            }

            async runErrorHandlingTests() {
                this.logTest('Error Handling', 'Testing error handling and graceful degradation...');

                const errorTestsHtml = document.getElementById('errorTests');
                errorTestsHtml.innerHTML = '';

                // Test error reporter
                if (typeof window.LASErrorReporter !== 'undefined') {
                    try {
                        const errorReporter = new window.LASErrorReporter({});
                        await errorReporter.init();
                        
                        // Test error reporting
                        const testError = new Error('Test error');
                        errorReporter.reportError(testError);
                        
                        const errors = errorReporter.getErrors();
                        const errorReported = errors.length > 0;
                        
                        this.recordTest('Error Reporting', errorReported, 
                            errorReported ? 'Error reporting works' : 'Error reporting failed');
                    } catch (error) {
                        this.recordTest('Error Reporting', false, `Error reporter failed: ${error.message}`);
                    }
                } else {
                    this.recordTest('Error Reporting', false, 'Error reporter class not available');
                }

                // Test graceful degradation
                if (typeof window.LASGracefulDegradation !== 'undefined') {
                    try {
                        const gracefulDegradation = new window.LASGracefulDegradation({});
                        await gracefulDegradation.init();
                        
                        gracefulDegradation.enable();
                        
                        const degradationEnabled = document.body.classList.contains('las-ui-degraded');
                        this.recordTest('Graceful Degradation', degradationEnabled, 
                            degradationEnabled ? 'Graceful degradation works' : 'Graceful degradation failed');
                    } catch (error) {
                        this.recordTest('Graceful Degradation', false, `Graceful degradation failed: ${error.message}`);
                    }
                } else {
                    this.recordTest('Graceful Degradation', false, 'Graceful degradation class not available');
                }

                // Create error test results display
                const errorCard = document.createElement('div');
                errorCard.className = 'test-card';
                errorCard.innerHTML = `
                    <h4>Error Handling Results</h4>
                    <div>Error Reporting: <span class="status-indicator ${this.getTestResult('Error Reporting') === 'pass' ? 'status-pass' : 'status-fail'}"></span></div>
                    <div>Graceful Degradation: <span class="status-indicator ${this.getTestResult('Graceful Degradation') === 'pass' ? 'status-pass' : 'status-fail'}"></span></div>
                `;
                errorTestsHtml.appendChild(errorCard);
            }

            async runPerformanceTests() {
                this.logTest('Performance', 'Testing performance metrics...');

                const performanceHtml = document.getElementById('performanceMetrics');
                const endTime = performance.now();
                const totalTime = endTime - this.startTime;

                // Performance thresholds
                const initTimeThreshold = 2000; // 2 seconds
                const memoryThreshold = 25 * 1024 * 1024; // 25MB

                // Test initialization time
                const initTimePass = totalTime < initTimeThreshold;
                this.recordTest('Initialization Time', initTimePass, 
                    `Initialization took ${totalTime.toFixed(2)}ms (threshold: ${initTimeThreshold}ms)`);

                // Test memory usage (if available)
                let memoryPass = true;
                let memoryInfo = 'Memory info not available';
                
                if (performance.memory) {
                    const usedMemory = performance.memory.usedJSHeapSize;
                    memoryPass = usedMemory < memoryThreshold;
                    memoryInfo = `Memory usage: ${(usedMemory / 1024 / 1024).toFixed(2)}MB (threshold: ${memoryThreshold / 1024 / 1024}MB)`;
                }
                
                this.recordTest('Memory Usage', memoryPass, memoryInfo);

                // Display performance metrics
                performanceHtml.innerHTML = `
                    <div class="test-grid">
                        <div class="test-card">
                            <h4>Timing Metrics</h4>
                            <div>Total Init Time: ${totalTime.toFixed(2)}ms</div>
                            <div>Status: <span class="status-indicator ${initTimePass ? 'status-pass' : 'status-fail'}"></span></div>
                        </div>
                        <div class="test-card">
                            <h4>Memory Metrics</h4>
                            <div>${memoryInfo}</div>
                            <div>Status: <span class="status-indicator ${memoryPass ? 'status-pass' : 'status-fail'}"></span></div>
                        </div>
                    </div>
                `;
            }

            recordTest(name, passed, message, level = null) {
                const result = {
                    name,
                    passed,
                    message,
                    level: level || (passed ? 'pass' : 'fail'),
                    timestamp: new Date().toISOString()
                };

                this.results.push(result);
                this.totalTests++;

                if (passed && level !== 'warn') {
                    this.passedTests++;
                } else if (level === 'warn') {
                    this.warnings++;
                } else {
                    this.failedTests++;
                }

                this.logTest(name, message, level || (passed ? 'pass' : 'fail'));
            }

            getTestResult(testName) {
                const result = this.results.find(r => r.name === testName);
                return result ? result.level : 'fail';
            }

            getOverallStatus(testNames) {
                const results = testNames.map(name => this.getTestResult(name));
                
                if (results.every(r => r === 'pass')) return 'pass';
                if (results.some(r => r === 'fail')) return 'fail';
                if (results.some(r => r === 'warn')) return 'warn';
                return 'pending';
            }

            updateStatus(elementId, status) {
                const element = document.getElementById(elementId);
                if (!element) return;

                const indicator = element.querySelector('.status-indicator');
                const text = element.childNodes[element.childNodes.length - 1];

                if (indicator) {
                    indicator.className = `status-indicator status-${status}`;
                }

                const statusText = {
                    pass: 'All tests passed',
                    fail: 'Some tests failed',
                    warn: 'Tests passed with warnings',
                    pending: 'Tests pending...'
                };

                if (text && text.nodeType === Node.TEXT_NODE) {
                    text.textContent = statusText[status] || 'Unknown status';
                }
            }

            updateProgress(percent, message) {
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');

                if (progressFill) {
                    progressFill.style.width = `${percent}%`;
                }

                if (progressText) {
                    progressText.textContent = message;
                }
            }

            generateSummary() {
                const summaryHtml = document.getElementById('testSummary');
                const successRate = this.totalTests > 0 ? (this.passedTests / this.totalTests * 100).toFixed(1) : 0;

                summaryHtml.innerHTML = `
                    <div class="test-grid">
                        <div class="test-card">
                            <h4>Test Statistics</h4>
                            <div>Total Tests: ${this.totalTests}</div>
                            <div>Passed: ${this.passedTests}</div>
                            <div>Failed: ${this.failedTests}</div>
                            <div>Warnings: ${this.warnings}</div>
                            <div>Success Rate: ${successRate}%</div>
                        </div>
                        <div class="test-card">
                            <h4>Overall Status</h4>
                            <div class="test-result ${this.failedTests === 0 ? 'test-pass' : 'test-fail'}">
                                ${this.failedTests === 0 ? 'ALL TESTS PASSED' : 'SOME TESTS FAILED'}
                            </div>
                        </div>
                    </div>
                    <div class="code-block" style="margin-top: 20px;">
${this.results.map(r => `[${r.level.toUpperCase()}] ${r.name}: ${r.message}`).join('\n')}
                    </div>
                `;
            }

            logTest(name, message, level = 'info') {
                const timestamp = new Date().toISOString();
                const prefix = `[LAS Test ${timestamp}]`;
                
                switch (level) {
                    case 'fail':
                        console.error(`${prefix} FAIL: ${name} - ${message}`);
                        break;
                    case 'warn':
                        console.warn(`${prefix} WARN: ${name} - ${message}`);
                        break;
                    case 'pass':
                        console.log(`${prefix} PASS: ${name} - ${message}`);
                        break;
                    default:
                        console.log(`${prefix} ${name} - ${message}`);
                }
            }

            logError(context, error) {
                console.error(`[LAS Test Error] ${context}:`, error);
            }

            exportResults() {
                const results = {
                    timestamp: new Date().toISOString(),
                    summary: {
                        totalTests: this.totalTests,
                        passedTests: this.passedTests,
                        failedTests: this.failedTests,
                        warnings: this.warnings,
                        successRate: this.totalTests > 0 ? (this.passedTests / this.totalTests * 100) : 0
                    },
                    tests: this.results
                };

                const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `las-integration-test-results-${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            resetTests() {
                this.results = [];
                this.totalTests = 0;
                this.passedTests = 0;
                this.failedTests = 0;
                this.warnings = 0;
                
                this.updateProgress(0, 'Tests reset');
                
                // Clear all status indicators
                ['environmentStatus', 'dependencyStatus', 'integrationStatus', 'componentStatus'].forEach(id => {
                    this.updateStatus(id, 'pending');
                });
                
                // Clear test result areas
                document.getElementById('componentTests').innerHTML = '';
                document.getElementById('errorTests').innerHTML = '';
                document.getElementById('performanceMetrics').innerHTML = '';
                document.getElementById('testSummary').innerHTML = '';
            }
        }

        // Global test suite instance
        let testSuite = new LASIntegrationTestSuite();

        // Global functions for buttons
        function runAllTests() {
            testSuite.resetTests();
            testSuite.runAllTests();
        }

        function runComponentTests() {
            testSuite.runComponentTests();
        }

        function runUITests() {
            testSuite.runUIFunctionalityTests();
        }

        function runErrorTests() {
            testSuite.runErrorHandlingTests();
        }

        function exportResults() {
            testSuite.exportResults();
        }

        function resetTests() {
            testSuite.resetTests();
        }

        // Auto-run tests when integration is ready
        document.addEventListener('las:integration:ready', () => {
            console.log('Integration ready, running automatic tests...');
            setTimeout(() => {
                runAllTests();
            }, 1000);
        });

        // Fallback: run tests after a delay if integration event doesn't fire
        setTimeout(() => {
            if (testSuite.totalTests === 0) {
                console.log('Running fallback tests...');
                runAllTests();
            }
        }, 5000);
    </script>
</body>
</html>