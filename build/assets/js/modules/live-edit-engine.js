(function(window,document){'use strict';class LiveEditEngine{constructor(core){this.core=core;this.isActive=false;this.targetedElement=null;this.highlightOverlay=null;this.microPanel=null;this.targetableSelectors=[ '#adminmenu','#adminmenu li','#adminmenu a','#wpadminbar','#wpadminbar .ab-item','#wpbody-content','#wpbody-content .wrap','.button','.button-primary','.form-table','input[type="text"]','input[type="email"]','input[type="password"]','textarea','select' ];this.hoverDelay=100;this.hoverTimer=null;this.panelOffset=10;this.viewportPadding=20;this.handleMouseMove=this.handleMouseMove.bind(this);this.handleMouseLeave=this.handleMouseLeave.bind(this);this.handleClick=this.handleClick.bind(this);this.handleKeyDown=this.handleKeyDown.bind(this);this.handleResize=this.handleResize.bind(this);this.init();}init(){this.createHighlightOverlay();this.setupEventListeners();this.core.log('LiveEditEngine initialized',{targetableSelectors: this.targetableSelectors.length});}createHighlightOverlay(){this.highlightOverlay=document.createElement('div');this.highlightOverlay.className='las-highlight-overlay';this.highlightOverlay.style.cssText=` position: absolute;pointer-events: none;z-index: 9998;border: 2px solid #0073aa;background: rgba(0,115,170,0.1);border-radius: 4px;transition: all 0.15s ease-out;display: none;`;document.body.appendChild(this.highlightOverlay);}setupEventListeners(){this.core.on('live-edit:toggle',(data)=>{this.toggle(data.active);});this.core.on('live-edit:activate',()=>{this.activate();});this.core.on('live-edit:deactivate',()=>{this.deactivate();});window.addEventListener('resize',this.handleResize);}toggle(active){if(active){this.activate();}else{this.deactivate();}}activate(){if(this.isActive){return;}this.isActive=true;document.body.classList.add('las-live-edit-active');document.addEventListener('mousemove',this.handleMouseMove,true);document.addEventListener('mouseleave',this.handleMouseLeave,true);document.addEventListener('click',this.handleClick,true);document.addEventListener('keydown',this.handleKeyDown,true);this.core.emit('live-edit:activated');this.core.log('Live edit mode activated');}deactivate(){if(!this.isActive){return;}this.isActive=false;document.body.classList.remove('las-live-edit-active');document.removeEventListener('mousemove',this.handleMouseMove,true);document.removeEventListener('mouseleave',this.handleMouseLeave,true);document.removeEventListener('click',this.handleClick,true);document.removeEventListener('keydown',this.handleKeyDown,true);this.hideHighlight();this.hideMicroPanel();this.targetedElement=null;this.core.emit('live-edit:deactivated');this.core.log('Live edit mode deactivated');}handleMouseMove(event){if(!this.isActive){return;}if(this.hoverTimer){clearTimeout(this.hoverTimer);}this.hoverTimer=setTimeout(()=>{this.processHover(event);},this.hoverDelay);}processHover(event){const element=this.findTargetableElement(event.target);if(element && element !==this.targetedElement){this.targetElement(element);}else if(!element && this.targetedElement){this.clearTarget();}}handleMouseLeave(event){if(!this.isActive){return;}if(!event.relatedTarget){this.clearTarget();}}handleClick(event){if(!this.isActive){return;}event.preventDefault();event.stopPropagation();if(this.targetedElement){this.selectElement(this.targetedElement);}}handleKeyDown(event){if(!this.isActive){return;}if(event.key==='Escape'){event.preventDefault();this.deactivate();}if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(event.key)){event.preventDefault();this.navigateElements(event.key);}}handleResize(){if(this.isActive && this.targetedElement){this.updateHighlight(this.targetedElement);if(this.microPanel){this.positionMicroPanel(this.targetedElement);}}}findTargetableElement(element){if(!element || element===document.body || element===document.documentElement){return null;}for(const selector of this.targetableSelectors){try{if(element.matches(selector)){return element;}}catch(error){continue;}}return this.findTargetableElement(element.parentElement);}targetElement(element){this.targetedElement=element;this.updateHighlight(element);this.showMicroPanel(element);this.core.emit('live-edit:element-targeted',{element: element,selector: this.getElementSelector(element)});}clearTarget(){if(this.targetedElement){this.targetedElement=null;this.hideHighlight();this.hideMicroPanel();this.core.emit('live-edit:element-cleared');}}selectElement(element){this.core.emit('live-edit:element-selected',{element: element,selector: this.getElementSelector(element),computedStyles: this.getElementStyles(element)});}navigateElements(direction){if(!this.targetedElement){const firstElement=document.querySelector(this.targetableSelectors[0]);if(firstElement){this.targetElement(firstElement);}return;}let nextElement=null;switch(direction){case 'ArrowUp': nextElement=this.findPreviousElement(this.targetedElement);break;case 'ArrowDown': nextElement=this.findNextElement(this.targetedElement);break;case 'ArrowLeft': nextElement=this.findParentElement(this.targetedElement);break;case 'ArrowRight': nextElement=this.findChildElement(this.targetedElement);break;}if(nextElement){this.targetElement(nextElement);}}findPreviousElement(element){const allTargetable=this.getAllTargetableElements();const currentIndex=allTargetable.indexOf(element);if(currentIndex > 0){return allTargetable[currentIndex-1];}return null;}findNextElement(element){const allTargetable=this.getAllTargetableElements();const currentIndex=allTargetable.indexOf(element);if(currentIndex >=0 && currentIndex < allTargetable.length-1){return allTargetable[currentIndex+1];}return null;}findParentElement(element){return this.findTargetableElement(element.parentElement);}findChildElement(element){for(const selector of this.targetableSelectors){try{const child=element.querySelector(selector);if(child && child !==element){return child;}}catch(error){continue;}}return null;}getAllTargetableElements(){const elements=[];for(const selector of this.targetableSelectors){try{const found=document.querySelectorAll(selector);elements.push(...Array.from(found));}catch(error){continue;}}const unique=[...new Set(elements)];return unique.sort((a,b)=>{const position=a.compareDocumentPosition(b);return position & Node.DOCUMENT_POSITION_FOLLOWING ?-1 : 1;});}updateHighlight(element){if(!element){this.hideHighlight();return;}const rect=element.getBoundingClientRect();const scrollTop=window.pageYOffset || document.documentElement.scrollTop;const scrollLeft=window.pageXOffset || document.documentElement.scrollLeft;this.highlightOverlay.style.cssText+=` display: block;left: ${rect.left+scrollLeft-2}px;top: ${rect.top+scrollTop-2}px;width: ${rect.width+4}px;height: ${rect.height+4}px;`;}hideHighlight(){this.highlightOverlay.style.display='none';}showMicroPanel(element){if(this.microPanel && this.microPanel.targetElement !==element){this.microPanel.destroy();this.microPanel=null;}if(!this.microPanel){this.createMicroPanel(element);}this.microPanel.show();}hideMicroPanel(){if(this.microPanel){this.microPanel.hide();}}createMicroPanel(element){const MicroPanel=this.core.getModule('micro-panel')|| window.LASMicroPanel;if(MicroPanel){this.microPanel=new MicroPanel(this.core,element,{showAnimations: true,autoHide: true,hideDelay: 3000,responsive: true});}else{this.core.handleError('MicroPanel module not available');}}getElementSelector(element){if(element.id){return `#${element.id}`;}if(element.className){const classes=element.className.split(' ').filter(c=> c.trim());if(classes.length > 0){return `${element.tagName.toLowerCase()}.${classes.join('.')}`;}}return element.tagName.toLowerCase();}getElementDisplayName(element){if(element.id){return `#${element.id}`;}const tagName=element.tagName.toLowerCase();const className=element.className ? `.${element.className.split(' ')[0]}` : '';return `${tagName}${className}`;}getElementStyles(element){const computed=window.getComputedStyle(element);return{backgroundColor: computed.backgroundColor,color: computed.color,fontSize: computed.fontSize,fontFamily: computed.fontFamily,padding: computed.padding,margin: computed.margin,border: computed.border,borderRadius: computed.borderRadius,width: computed.width,height: computed.height,display: computed.display,position: computed.position};}isLiveEditActive(){return this.isActive;}getTargetedElement(){return this.targetedElement;}destroy(){this.deactivate();if(this.highlightOverlay && this.highlightOverlay.parentNode){this.highlightOverlay.parentNode.removeChild(this.highlightOverlay);}if(this.microPanel && typeof this.microPanel.destroy==='function'){this.microPanel.destroy();}window.removeEventListener('resize',this.handleResize);if(this.hoverTimer){clearTimeout(this.hoverTimer);}this.core.log('LiveEditEngine destroyed');}}if(typeof module !=='undefined' && module.exports){module.exports=LiveEditEngine;}if(typeof define==='function' && define.amd){define([],function(){return LiveEditEngine;});}if(window.LAS && typeof window.LAS.registerModule==='function'){window.LAS.registerModule('live-edit-engine',LiveEditEngine);}window.LASLiveEditEngine=LiveEditEngine;})(window,document);